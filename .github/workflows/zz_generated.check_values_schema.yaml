# DO NOT EDIT. Generated with:
#
#    devctl@5.13.0
#
name: 'Check if values schema file has been updated'
on: pull_request
    branches:
      - master
      - main
    paths:
      - 'helm/**/values.yaml'
      - 'helm/**/values.schema.json'

jobs:
  check:
    name: 'Check values.yaml and its schema in PR'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: 'Check if values.yaml is a valid instance of values.schema.json'
        run: |
          HELM_DIR=$(dirname $(git diff --name-only origin/${GITHUB_BASE_REF} origin/${GITHUB_HEAD_REF} \
           | grep 'helm/[-a-z].*\/values\.' | head -1))
          VALUES_FILE=${HELM_DIR}/values.yaml
          SCHEMA_FILE=${HELM_DIR}/values.schema.json
          pip3 install json-spec==0.10.1
          yq -o=json eval ${VALUES_FILE} > /tmp/values.json
          json validate --schema-file=${SCHEMA_FILE} --document-file=/tmp/values.json
          echo "PASSED: values.yaml and values.schema.json both appear to have been updated and the document is valid against the schema"
