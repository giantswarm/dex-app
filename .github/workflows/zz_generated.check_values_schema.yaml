# DO NOT EDIT. Generated with:
#
#    devctl@5.13.1
#
name: 'Check if values and/or schema file has been updated'
on:
  pull_request:
    branches:
      - master
      - main
    paths:
      - 'helm/**/values.yaml'
      - 'helm/**/values.schema.json'

jobs:
  check:
    name: 'Check values.yaml and its schema in PR'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Install schema validator
        run: |
          wget -O /usr/bin/yajsv https://github.com/neilpa/yajsv/releases/download/v1.4.1/yajsv.linux.amd64
          chmod +x /usr/bin/yajsv

      - name: 'Check if values.yaml is a valid instance of values.schema.json'
        run: |
          HELM_DIR=$(dirname $(git diff --name-only origin/${GITHUB_BASE_REF} origin/${GITHUB_HEAD_REF} \
           | grep 'helm/[-a-z].*\/values\.' | head -1))
          /usr/bin/yajsv -s ${HELM_DIR}/values.schema.json ${HELM_DIR}/values.yaml
